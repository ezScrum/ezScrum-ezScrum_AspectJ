*** Settings ***
Library           ../lib/Selenium2Improved.py
Resource          ../../Global Define.txt
Resource          ../common_resource.txt
Resource          ../Project/ezScrum_Project.txt

*** Keywords ***
Test Sprint Backlog - PreCondition
    Login Page    ${LOGIN_URL}
    # 確認專案是否存在
    Wait Until Page Contains Element    createProjectBtn
    ${_IsProjectIDExisted}=    Check ProjectID Is Existed    ${PROJECT_NAME}
    Run Keyword If    "${_IsProjectIDExisted}"=="false"    Create Project
    Run Keyword If    "${_IsProjectIDExisted}"=="true"    Select Project    ${PROJECT_NAME}DisplayName
    Select Node Product    Sprint Plan
    Create Sprint    sprint1 sprint goal    2    4    100    100

Test Sprint Backlog - PostCondition
    # delete story and tag
    Clean All Story
    Clean All Tag
    # delete sprint
    Clean All Sprint
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}

Test Sprint Backlog - Edit Story Setup
    Comment    Test Sprint Backlog - PreCondition
    #setup
    Open Browser    ${LOGIN_URL}    ${BROWSER}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintBacklog    Edit_Story.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Maximize Browser Window
    _InputLoginForm    ${userName}    ${userPassword}
    #Select project
    Select Project    localtestProjectDisplayName
    Select Node Product    Sprint Backlog
    Create Story With Arguments    add story for test edit story    0    0    0    ${EMPTY}    "Note: newStoryNormal"
    ...    "HowToDemo: newStoryNormal"

Test Sprint Backlog - Edit Story Teardown
    Comment    Test Sprint Backlog - PostCondition
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Exit ezScrum System

Test Sprint Backlog - Add Story Setup
    Comment    Test Sprint Backlog - PreCondition
    #setup
    Open Browser    ${LOGIN_URL}    ${BROWSER}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintBacklog    Add_Story.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Maximize Browser Window
    _InputLoginForm    ${userName}    ${userPassword}
    #Select project
    Select Project    localtestProjectDisplayName
    Select Node Product    Sprint Backlog

Test Sprint Backlog - Add Story Teardown
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Comment    Test Sprint Backlog - PostCondition
    Exit ezScrum System

Test Sprint Backlog - Drop Story Setup
    Comment    Test Sprint Backlog - PreCondition
    #setup
    Open Browser    ${LOGIN_URL}    ${BROWSER}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintBacklog    Drop_Story.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Maximize Browser Window
    _InputLoginForm    ${userName}    ${userPassword}
    #Select project
    Select Project    localtestProjectDisplayName
    Select Node Product    Sprint Backlog
    Comment    Create Story With Arguments    add story for test drop story    0    0    0    ${EMPTY}
    ...    "Note: dropStory"    "HowToDemo: dropStory"

Test Sprint Backlog - Drop Story Teardown
    Comment    Test Sprint Backlog - PostCondition
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Exit ezScrum System

Test Sprint Backlog - Add Existing Story Setup
    ${SQLFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintBacklog    Add_Existing_Stories.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${SQLFilePath}
    Login Page    ${LOGIN_URL}
    ${PROJECT_NAME}    Set Variable    Project01
    Select Project    ${PROJECT_NAME}

Test Sprint Backlog - Add Existing Story Teardown
    Comment    Test Sprint Backlog - PostCondition
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Exit ezScrum System

Test Sprint Backlog - Edit Sprint Setup
    Comment    Test Sprint Backlog - PreCondition
    #setup
    Open Browser    ${LOGIN_URL}    ${BROWSER}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintBacklog    Edit_Sprint.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Maximize Browser Window
    _InputLoginForm    ${userName}    ${userPassword}
    #Select project
    Select Project    localtestProjectDisplayName
    Select Node Product    Sprint Plan

Test Sprint Backlog - Edit Sprint Teardown
    Comment    Test Sprint Backlog - PostCondition
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Exit ezScrum System

Test Sprint Backlog - Add Task Setup
    Comment    Test Sprint Backlog - PreCondition
    Comment    Select Node Product    Sprint Backlog
    Comment    Create Story With Arguments    story for add task    0    0    0    ${EMPTY}
    ...    for add task    display after add task
    #setup
    Open Browser    ${LOGIN_URL}    ${BROWSER}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintBacklog    Add_Task.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Maximize Browser Window
    _InputLoginForm    ${userName}    ${userPassword}
    #Select project
    Select Project    localtestProjectDisplayName
    Select Node Product    Sprint Backlog
    Set Test Variable    ${storyName}    story for add task

Test Sprint Backlog - Add Task Teardown
    Comment    Test Sprint Backlog - PostCondition
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Exit ezScrum System

Test Sprint Backlog - Edit Task Setup
    Comment    Test Sprint Backlog - PreCondition
    Comment    Select Node Product    Sprint Backlog
    Comment    Create Story With Arguments    story for edit task    0    0    0    ${EMPTY}
    ...    for edit task    display after edit task
    #setup
    Open Browser    ${LOGIN_URL}    ${BROWSER}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintBacklog    Edit_Task.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Maximize Browser Window
    _InputLoginForm    ${userName}    ${userPassword}
    #Select project
    Select Project    localtestProjectDisplayName
    Select Node Product    Sprint Backlog
    Set Test Variable    ${storyName}    story for edit task

Test Sprint Backlog - Edit Task Teardown
    Comment    Test Sprint Backlog - PostCondition
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Exit ezScrum System

Test Sprint Backlog - Drop Task Setup
    Comment    Test Sprint Backlog - PreCondition
    #setup
    Open Browser    ${LOGIN_URL}    ${BROWSER}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintBacklog    Drop_Task.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Maximize Browser Window
    _InputLoginForm    ${userName}    ${userPassword}
    #Select project
    Select Project    localtestProjectDisplayName
    Select Node Product    Sprint Backlog
    Comment    Create Story With Arguments    story for drop task    0    0    0    ${EMPTY}
    ...    for drop task    display after drop task
    Set Test Variable    ${storyName}    story for drop task

Test Sprint Backlog - Drop Task Teardown
    Comment    Test Sprint Backlog - PostCondition
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Exit ezScrum System

Test Sprint Backlog - Add Existing Task Setup
    Comment    Test Sprint Backlog - PreCondition
    #setup
    Open Browser    ${LOGIN_URL}    ${BROWSER}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintBacklog    Add_Existing_Task.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Maximize Browser Window
    _InputLoginForm    ${userName}    ${userPassword}
    #Select project
    Select Project    localtestProjectDisplayName
    Select Node Product    Sprint Backlog
    Comment    Create Story With Arguments    story for add existing task    0    0    0    ${EMPTY}
    ...    for add existing task    display after add existing task
    Set Test Variable    ${storyName}    story for add existing task

Test Sprint Backlog - Add Existing Task Teardown
    Comment    Test Sprint Backlog - PostCondition
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Exit ezScrum System

Test Sprint Backlog - Show Task History Setup
    Comment    Test Sprint Backlog - PreCondition
    #setup
    Open Browser    ${LOGIN_URL}    ${BROWSER}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintBacklog    Show_Task_History.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Maximize Browser Window
    _InputLoginForm    ${userName}    ${userPassword}
    #Select project
    Select Project    localtestProjectDisplayName
    Select Node Product    Sprint Backlog
    Create Story With Arguments    story for show task history    0    0    0    ${EMPTY}    for show task history
    ...    display after show task history
    Set Test Variable    ${storyName}    story for show task history

Test Sprint Backlog - Show Task History Teardown
    Comment    Test Sprint Backlog - PostCondition
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Exit ezScrum System

Test Sprint Backlog - Printable Task Setup
    [Arguments]    ${Sql_name}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintBacklog    ${Sql_name}
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Login Page    ${LOGIN_URL}

Test Sprint Backlog - Printable Task Teardown
    Data Base Tear Down
    Close Browser
    Close All Browsers

Check If Invalid Date
    ${count}=    Get Matching Xpath Count    //span[text()="Invalid Date!!"]
    ${IsInvalidDate}=    Set Variable If    ${count}==1    true    ${count}!=1    false
    [Return]    ${IsInvalidDate}

Skip Adding New Sprint
    Click Button    //button[text()="OK"]
    Click Button    //span[text()="Add New Sprint"]/../../../../../div[2]//button[text()="Cancel"]
